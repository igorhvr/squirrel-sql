<HTML>

<HEAD>
    <TITLE>Refactoring Plugin</TITLE>
</HEAD>

<BODY>

<font size="+2"><b>Refactoring Plugin</b></font><font size="+1"> - Rob Manning</font>


<H3>Introduction</H3>

<P>The Refactoring plugin adds the ability to easily change the definition or 
structure of tables / columns in a database.  Changes can be made or the SQL for
any particular refactoring can be viewed and/or edited.  The SQL that is 
generated is crafted specifically for the database that SQuirreL is connected to
and is made with the help of an extended Hibernate dialect framework.  You can
choose from the following extended Hibernate dialects:

<p>

<center>
<table cellspacing="10" cellpadding="5">
<tr>
<td align="center">
Apache Derby
</td>
<td align="center">
Axion
</td>
<td align="center">
Daffodil
</td>
<td align="center">
DB2
</td>
<td align="center">
Firebird
</td>
</tr>
<tr>
<td align="center">
FrontBase
</td>
<td align="center">
H2
</td>
<td align="center">
HSQLDB
</td>
<td align="center">
Informix
</td>
<td align="center">
CA Ingres
</td>
</tr>
<tr>
<td align="center">
MaxDB
</td>
<td align="center">
Mckoi
</td>
<td align="center">
MS-SQLServer
</td>
<td align="center">
MySQL
</td>
<td align="center">
Oracle
</td>
</tr>
<tr>
<td align="center">
Pointbase
</td>
<td align="center">
PostgreSQL
</td>
<td align="center">
Sybase ASE 12/15
</td>
<td align="center">
TimesTen
</td>
</tr>
</table>
</center>

<p>

The following refactorings are supported*: <br>
<ul>
<li>Add/Drop Primary Key</li>
<li>Add/Drop Column</li>
<li>Modify column (type, length, default value, comment, null/not null)</li>
</ul>

* Note: If the database doesn't support the refactoring directly with SQL, 
then the refactoring will be unavailable for that database.  For example, 
when this document was written, Apache Derby (10.2.1.6) allowed you 
to add a new column to an existing table using a SQL statement like :
<p>
'ALTER TABLE ... ADD COLUMN ...'
<p>
yet it didn't provide a way to drop an existing column via some SQL statement 
such as :
<p>
'ALTER TABLE ... DROP COLUMN ...' 
<p>
like many other databases do. A future release of the refactoring plugin will 
provide implementations of all refactorings on databases that don't support 
them directly.
<p>
The following table summarizes the refactorings and their availability on 
each supported database:
<p>
<center>
<table border="1"> 
 <tr>
  <td width="60" align="center"></td>
  <td width="60" align="center">Add <br>Column</td>
  <td width="60" align="center">Drop <br>Column</td>
  <td width="60" align="center">Default<br> Value</td>
  <td width="60" align="center">Column<br>Comment</td>
  <td width="60" align="center">Column <br>Nullable</td>
  <td width="60" align="center">Column <br>Name</td>
  <td width="60" align="center">Column <br>Type</td>
  <td width="60" align="center">Add<br> PK</td>
  <td width="60" align="center">Drop <br>PK</td>
 </tr>
 <tr>
  <td align="center">Axion</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">Daffodil</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">DB2</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">Apache Derby</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">Firebird</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">FrontBase</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
 </tr>
 <tr>
  <td align="center">H2</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">HSQLDB</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">Informix</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">CA Ingres</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">MaxDB</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">Mckoi</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">MS-SQLServer</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">MySQL</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">Oracle</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">Pointbase</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">PostgreSQL</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">Sybase</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
 </tr>
 <tr>
  <td align="center">TimesTen</td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center"><img src="images/checkmark.gif"></td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
  <td align="center">-</td>
 </tr>
</table>
</center>
<p>
If you find that a supported database has been updated to support an operation
directly via SQL, I would appreciate an email to let me know so that I can 
update the refactoring plugin.(manningr [at] users [dot] sourceforge [dot] net)
<p>
<h3>Add Primary Key</h3>

A table that doesn't already have a Primary Key defined can be altered to 
specify one.  A primary key uniquely identifies each row in the table, and as
such must consist only of one or more "non-null" columns.  For some databases 
defining a primary key after table creation implicitly creates constraints 
which check for "non-null" property, while others require explicit SQL to add
these constraints manually.  The add primary key feature of the refactoring 
plugin takes this into consideration for each supported database when generating
the SQL necessary to make this change.  The following screenshots illustrate 
adding a primary key to an existing table.
<p>
<center>
<img src="images/add_pk/1_add_pk_menu.jpg"><br>
<b><i> Figure 1. Right-click to access the context menu for adding a Primary Key</i></b>
</center>
<p>
First, choose a table to add a primary key to and right-click to access the 
refactoring menus.
<p>
<center>
<img src="images/add_pk/2_choose_pk_dialog_unslected.jpg"><br>
<b><i> Figure 2. Dialog displaying columns available for PK in the selected table</i></b>
</center>
<p>
You will see a dialog displaying all of the columns from the selected table that 
are available for use in the new primary key.  You may also change the name of
the constraint that is used to enforce the primary key by changing the 
"Primary Key Name", which by default is set to PK_&lt;Table Name&gt;
<p>
<center>
<img src="images/add_pk/3_choose_pk_dialog_slected.jpg"><br>
<b><i> Figure 3. Choosing a single column to be the Primary Key</i></b>
</center>
<p>
Next, choose the column (or columns) that will form the new primary key for the 
selected table.
<p>
<center>
<img src="images/add_pk/4_add_pk_sql.jpg"><br>
<b><i> Figure 4. Showing the SQL for adding a PK to the table</i></b>
</center>
<p>
You can display the SQL that will be executed by clicking on the "Show SQL" 
button.  Alternatively, you can click the "Edit SQL" button and the refactoring
SQL will be placed into the SQL editor tab for you to inspect/customize before
executing.
<p>
<center>
<img src="images/add_pk/5_add_pk_after_execute.jpg"><br>
<b><i> Figure 5. After clicking the "Execute" button the change is applied</i></b>
</center>
<p>
When you are satisfied that you want to apply the refactoring to the selected
table, click the "Execute" button to apply the change. You can click "Cancel"
at any time and the refactoring will not be applied.
<p>
<h3>Drop Primary Key</h3>

A table which has a Primary Key defined can be altered to remove it.
First, access the "Drop Primary Key" menu by right-clicking on a selected table.
<center>
<p>
<img src="images/drop_pk/1_drop_pk_menu.jpg"><br>
<b><i> Figure 6. Right-click to access the context menu for dropping a Primary Key</i></b>
<p>
</center>
Next, choose "Drop Primary Key" and the drop primary key dialog will appear 
showing the column(s) defined in the Primary Key for the selected table.
<center>
<img src="images/drop_pk/2_drop_pk_dialog.jpg"><br>
<b><i> Figure 7. The Drop Primary Key dialog</i></b>
</center>
<h3>Add Column</h3>
For most databases, columns can be added to an existing table without dropping 
the table and re-creating it.
<p>
<center>
<img src="images/add_column/1_add_column_menu.jpg"><br>
<b><i> Figure 8. Right-click to access the context menu for adding a column</i></b>
</center>
<p>
The add column dialog allows you to specify the definition of the new column to 
be added to the selected table.  Some attributes may be read-only in the case 
where the database doesn't support the attribute (for example, column comments) , 
or else don't allow them to be used when adding columns.  In this case, the 
dialog field that corresponds to an unavailable attribute will be disabled.  The
"Dialect" drop-down list allows you to see the effect on the SQL when using a 
different dialect (the SQL generated will be according to the dialect chosen - 
the dialect of the connected database is selected by default)  The type of the
column can be chosen from the type list (the types are standard JDBC types which
get mapped to vendor-specific types by the dialect specified in the dialect 
list).  The other fields represent allowable attributes of columns in most 
databases and should be self-explanatory.  One thing to note regarding types and
length / precision and scale - precision and scale only apply to number types, 
such as NUMERIC, DECIMAL, FLOAT, etc.  The length attribute only applies to 
character and byte types such as VARCHAR, CHAR, BINARY, etc.  In most databases
when using BLOB and CLOB types, these attributes are ignored since large objects
have length that is variable and high-capacity (2GB).
<p>
<center>
<img src="images/add_column/2_add_column_dialog.jpg"><br>
<b><i> Figure 9. The add column dialog</i></b>
</center>
<p>
The same options that were available for adding primary keys are also available
for adding columns (Execute, Show SQL and Edit SQL).
<p>
<center>
<img src="images/add_column/3_add_column_show_sql.jpg"><br>
<b><i> Figure 10. The SQL for the new column addition</i></b>
</center>
<p>
<h3>Modify Column</h3>
Existing columns can be modified in most databases, although with many more 
restrictions on supported attributes than adding a new column.  
<p>
<center>
<img src="images/modify_column/1_modify_column_menu.jpg"><br>
<b><i> Figure 10. Right-click to access the context menu for modifying a column</i></b>
</center>
<p>
Only one column at a time may be modified in the selected table.
<p>
<center>
<img src="images/modify_column/2_modify_column_dialog.jpg"><br>
<b><i> Figure 11. Choose a column to modify</i></b>
</center>
<p>
The attributes of the column to be modified appear in the modify column dialog
populated with the current values.  Similar to adding columns, attributes that
are immutable on existing columns in the specified dialect are disable 
(read-only).
<p>
<center>
<img src="images/modify_column/3_modify_column_dialog.jpg"><br>
<b><i> Figure 12. Modify attributes of the selected column</i></b>
</center>

<h3>Drop Column</h3>
Columns can also be removed from an existing table.  Access the drop column 
refactoring menu in the same way as modifying an existing column (See Figure 10.)


</BODY>
</HTML>

